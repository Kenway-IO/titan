>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TITAN Framework | Kenway Consulting Style</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        kenway: {
                            navy: '#0f2c52', // Deep corporate navy
                            blue: '#007cc0', // Vibrant accent blue
                            red: '#D32F2F',  // Kenway Red accent
                            gray: '#f4f4f4', // Light gray background
                            text: '#333333', // Primary text
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        classic: ['Cinzel', 'serif'], // Added classic serif font
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-out',
                        'slide-up': 'slideUp 0.4s ease-out',
                        'shimmer': 'shimmer 3s cubic-bezier(0.4, 0, 0.2, 1) infinite',
                        'spin-slow': 'spin 60s linear infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        shimmer: {
                            '0%': { transform: 'translateX(-100%)' },
                            '100%': { transform: 'translateX(400%)' }
                        }
                    }
                }
            }
        }
    </script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }
        
        .sidebar-link.active {
            background-color: #0f2c52; /* Kenway Navy */
            color: white;
            border-left: 4px solid #007cc0; /* Accent Blue */
        }
        
        .prose h2 {
            margin-top: 2.5rem;
            margin-bottom: 1.5rem;
            font-weight: 700;
            color: #0f2c52;
            font-size: 1.75rem;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 0.5rem;
        }
        
        .prose h3 {
            margin-top: 2rem;
            margin-bottom: 1rem;
            font-weight: 600;
            color: #0f2c52;
            font-size: 1.25rem;
        }
        
        .prose p {
            margin-bottom: 1.25rem;
            color: #4b5563;
            line-height: 1.8;
            font-size: 1.05rem;
        }

        .hero-gradient {
            background: linear-gradient(135deg, #0f2c52 0%, #1e4070 100%);
        }
        
        .text-gradient-red {
             background: linear-gradient(90deg, #D32F2F 0%, #FFFFFF 100%);
             -webkit-background-clip: text;
             -webkit-text-fill-color: transparent;
        }

        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        /* Flow Chart Styles */
        .flow-line {
            position: absolute;
            background-color: #cbd5e1;
            z-index: 0;
        }
        .flow-node {
            transition: all 0.3s ease;
        }
        .flow-node:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        
        /* Modal Scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* EKG Pulse Animation */
        .ekg-path {
            stroke-dasharray: 150 2000;
            stroke-dashoffset: 2150;
            animation: ekg-flow 3s linear infinite;
            filter: drop-shadow(0 0 4px rgba(0, 124, 192, 0.5));
        }
        
        @keyframes ekg-flow {
            0% { stroke-dashoffset: 2150; }
            100% { stroke-dashoffset: -150; }
        }
    </style>
</head>
<body class="bg-gray-50 text-kenway-text antialiased">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- MOCK DATA FOR PREVIEW (Replaces external JSON fetch) ---
        const MOCK_INVENTORY = {
            "flow1": {
                "title": "New Customer Onboarding",
                "impact": "$250k/yr",
                "description": "Automating the setup of new clients across CRM, ERP, and Support systems.",
                "steps": [
                    { "stage": "TRIGGER", "label": "Contract Signed", "system": "Salesforce", "icon": "Zap", "color": "bg-kenway-navy" },
                    { "stage": "INGEST", "label": "Get Customer Details", "system": "Data Lake", "icon": "Database", "color": "bg-kenway-blue" },
                    { "stage": "THINK", "label": "Credit Check & Territory", "system": "Azure Functions", "icon": "BrainCircuit", "color": "bg-purple-600", "highlight": true },
                    { "stage": "ACT", "label": "Create SAP Customer", "system": "SAP ERP", "icon": "Activity", "color": "bg-orange-500" },
                    { "stage": "NOTIFY", "label": "Welcome Email", "system": "SendGrid", "icon": "CheckCircle", "color": "bg-green-600" }
                ],
                "techStack": ["Azure Logic Apps", "Salesforce Webhooks", "SAP OData", "SendGrid API"],
                "successCriteria": "Customer created in SAP within 5 minutes of Salesforce contract signature."
            },
            "flow2": {
                "title": "IoT Predictive Maintenance",
                "impact": "$1.2M/yr",
                "description": "Ingesting sensor data to predict equipment failure before it happens.",
                "steps": [
                    { "stage": "TRIGGER", "label": "Vibration Threshold", "system": "IoT Hub", "icon": "Zap", "color": "bg-kenway-navy" },
                    { "stage": "INGEST", "label": "Enrich Metadata", "system": "Digital Twin", "icon": "Database", "color": "bg-kenway-blue" },
                    { "stage": "THINK", "label": "Failure Prob. Model", "system": "Azure ML", "icon": "BrainCircuit", "color": "bg-purple-600", "highlight": true },
                    { "stage": "ACT", "label": "Schedule Work Order", "system": "Dyn 365 Field Svc", "icon": "Activity", "color": "bg-orange-500" },
                    { "stage": "NOTIFY", "label": "Alert Plant Mgr", "system": "Teams", "icon": "CheckCircle", "color": "bg-green-600" }
                ],
                "techStack": ["Azure IoT Hub", "Azure Stream Analytics", "Azure ML", "Dynamics 365"],
                "successCriteria": "Work order created 4 hours prior to predicted failure."
            },
            "flow3": {
                "title": "E-Commerce Order Fulfillment",
                "impact": "$5M/yr",
                "description": "Orchestrating order flow from Shopify to warehouse and finance.",
                "steps": [
                    { "stage": "TRIGGER", "label": "Order Placed", "system": "Shopify", "icon": "Zap", "color": "bg-kenway-navy" },
                    { "stage": "INGEST", "label": "Validate Inventory", "system": "ERP Core", "icon": "Database", "color": "bg-kenway-blue" },
                    { "stage": "THINK", "label": "Fraud Detection", "system": "Azure AI", "icon": "BrainCircuit", "color": "bg-purple-600", "highlight": true },
                    { "stage": "ACT", "label": "Allocate Stock", "system": "WMS", "icon": "Activity", "color": "bg-orange-500" },
                    { "stage": "NOTIFY", "label": "Shipping Update", "system": "SMS Gateway", "icon": "CheckCircle", "color": "bg-green-600" }
                ],
                "techStack": ["Azure Service Bus", "Cosmos DB", "Shopify API", "Twilio"],
                "successCriteria": "99.9% of orders processed without human intervention."
            }
        };

        // --- Icons ---
        const Icon = ({ children, size = 24, className = "", ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>
                {children}
            </svg>
        );

        const Activity = (props) => <Icon {...props}><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></Icon>;
        const Database = (props) => <Icon {...props}><ellipse cx="12" cy="5" rx="9" ry="3"></ellipse><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path></Icon>;
        const BrainCircuit = (props) => <Icon {...props}><path d="M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z" /><path d="M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z" /><path d="M12 13h4" /><path d="M12 18h6a2 2 0 0 1 2 2v1" /><path d="M12 8h8" /></Icon>;
        const Zap = (props) => <Icon {...props}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></Icon>;
        const CheckCircle = (props) => <Icon {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></Icon>;
        const Menu = (props) => <Icon {...props}><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></Icon>;
        const X = (props) => <Icon {...props}><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></Icon>;
        const Calculator = (props) => <Icon {...props}><rect x="4" y="2" width="16" height="20" rx="2"></rect><line x1="8" y1="6" x2="16" y2="6"></line><line x1="16" y1="14" x2="16" y2="14"></line><line x1="12" y1="14" x2="12" y2="14"></line><line x1="8" y1="14" x2="8" y2="14"></line><line x1="16" y1="18" x2="16" y2="18"></line><line x1="12" y1="18" x2="12" y2="18"></line><line x1="8" y1="18" x2="8" y2="18"></line></Icon>;
        const LayoutTemplate = (props) => <Icon {...props}><rect width="18" height="18" x="3" y="3" rx="2"></rect><path d="M3 9h18"></path><path d="M9 21V9"></path></Icon>;
        const ArrowRight = (props) => <Icon {...props}><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></Icon>;
        const Server = (props) => <Icon {...props}><rect x="2" y="2" width="20" height="8" rx="2" ry="2"></rect><rect x="2" y="14" width="20" height="8" rx="2" ry="2"></rect><line x1="6" y1="6" x2="6.01" y2="6"></line><line x1="6" y1="18" x2="6.01" y2="18"></line></Icon>;
        const ChevronUp = (props) => <Icon {...props}><polyline points="18 15 12 9 6 15"></polyline></Icon>;
        const ChevronDown = (props) => <Icon {...props}><polyline points="6 9 12 15 18 9"></polyline></Icon>;
        const Cloud = (props) => <Icon {...props}><path d="M17.5 19c0-1.7-1.3-3-3-3h-1.1c-.1-1.2-.6-2.3-1.5-3.1-.9-.8-2-1.3-3.2-1.3-2.5 0-4.6 1.8-5 4.2C2.1 16.1 1 17.4 1 19c0 2.2 1.8 4 4 4h12.5c2.5 0 4.5-2 4.5-4.5s-2-4.5-4.5-4.5z"></path></Icon>;
        const FileText = (props) => <Icon {...props}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></Icon>;
        const BookOpen = (props) => <Icon {...props}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></Icon>;
        const Layers = (props) => <Icon {...props}><polygon points="12 2 2 7 12 12 22 7 12 2"></polygon><polyline points="2 17 12 22 22 17"></polyline><polyline points="2 12 12 17 22 12"></polyline></Icon>;
        
        // New Icons
        const Mail = (props) => <Icon {...props}><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></Icon>;
        const MousePointer = (props) => <Icon {...props}><path d="M3 3l7.07 16.97 2.51-7.39 7.39-2.51L3 3z"></path><path d="M13 13l6 6"></path></Icon>;
        const Clock = (props) => <Icon {...props}><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></Icon>;
        const User = (props) => <Icon {...props}><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></Icon>;
        const AppWindow = (props) => <Icon {...props}><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="9" y1="21" x2="9" y2="9"></line></Icon>;
        const MessageSquare = (props) => <Icon {...props}><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></Icon>;
        const AlertTriangle = (props) => <Icon {...props}><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></Icon>;
        const Wifi = (props) => <Icon {...props}><path d="M5 12.55a11 11 0 0 1 14.08 0"></path><path d="M1.42 9a16 16 0 0 1 21.16 0"></path><path d="M8.53 16.11a6 6 0 0 1 6.95 0"></path><line x1="12" y1="20" x2="12.01" y2="20"></line></Icon>;

        // Icon mapping helper since we are loading data from JSON strings
        const IconMap = {
            Zap: Zap,
            Database: Database,
            BrainCircuit: BrainCircuit,
            Activity: Activity,
            CheckCircle: CheckCircle,
            Cloud: Cloud,
            FileText: FileText,
            Server: Server
        };

        // --- Methodology Data for Modals (MOCK FALLBACK) ---
        const MOCK_METHODOLOGY_DETAILS = {
            'T': {
                title: "Trigger",
                subtitle: "The Pulse of the Enterprise",
                description: "The Trigger stage initiates the integration loop. Unlike traditional batch ETL, TITAN prioritizes real-time, event-driven pulses that allow the business to react instantly to changes.",
                keyActivities: [
                    "Listening for Business Events (e.g., 'Order Placed')",
                    "Detecting Data Changes (CDC)",
                    "Handling IoT Sensor Signals",
                    "Scheduled Temporal Events (e.g., 'End of Day')"
                ],
                patterns: [
                    { name: "Webhooks", desc: "Push-based HTTP callbacks from SaaS apps." },
                    { name: "Change Data Capture (CDC)", desc: "Database log mining for zero-impact extraction." },
                    { name: "Event Sourcing", desc: "Storing state changes as an immutable sequence of events." }
                ],
                azureTech: ["Azure Event Grid", "Azure Service Bus", "Logic Apps Triggers"]
            },
            'I': {
                title: "Ingest",
                subtitle: "Contextual Awareness",
                description: "Raw triggers are rarely enough. The Ingest stage is responsible for 'The Claim Check Pattern'—taking a lightweight ID and hydrating it with the full context needed for decision making.",
                keyActivities: [
                    "Fetching Master Data (e.g., Customer Profile)",
                    "Retrieving Transaction History",
                    "Standardizing Data Formats (JSON/Avro)",
                    "Validating Data Quality"
                ],
                patterns: [
                    { name: "Claim Check", desc: "Passing a reference ID to keep the message bus light." },
                    { name: "Enrichment", desc: "Calling external APIs to append missing data." },
                    { name: "Normalization", desc: "Converting proprietary schemas to a Canonical Data Model." }
                ],
                azureTech: ["Azure API Management", "Azure Functions", "Azure Data Factory", "Cosmos DB"]
            },
            'T2': { // Using T2 key for Think to distinguish from Trigger
                title: "Think",
                subtitle: "The Intelligence Layer",
                description: "This is the differentiator. Instead of blindly routing data, TITAN assesses the situation. Is this a standard order? Is it fraud? Does it require VP approval?",
                keyActivities: [
                    "Applying Business Rules",
                    "Executing AI/ML Models",
                    "Sentiment Analysis",
                    "Routing Decisions"
                ],
                patterns: [
                    { name: "Content-Based Routing", desc: "Directing flow based on payload data." },
                    { name: "Agentic AI", desc: "Using LLMs to make unstructured decisions." },
                    { name: "Complex Event Processing", desc: "Detecting patterns across multiple events." }
                ],
                azureTech: ["Azure OpenAI", "Azure Stream Analytics", "Drools / Business Rules Engine"]
            },
            'A': {
                title: "Act",
                subtitle: "Deterministic Execution",
                description: "The 'Muscle' of the operation. Once a decision is made, the Act stage executes the state change in the target system. Reliability and idempotency are paramount here.",
                keyActivities: [
                    "Creating/Updating Records (CRUD)",
                    "Initiating Payments",
                    "Provisioning Resources",
                    "Triggering Downstream Workflows"
                ],
                patterns: [
                    { name: "Idempotency", desc: "Ensuring re-running the same action doesn't duplicate results." },
                    { name: "Saga Pattern", desc: "Managing long-running distributed transactions." },
                    { name: "Circuit Breaker", desc: "Failing fast when downstream systems are down." }
                ],
                azureTech: ["Logic Apps Connectors", "Durable Functions", "Power Automate"]
            },
            'N': {
                title: "Notify",
                subtitle: "Resolution & Feedback",
                description: "Closing the loop. Every action generates a receipt. The Notify stage informs stakeholders of success, handles errors, or triggers human-in-the-loop remediation.",
                keyActivities: [
                    "Sending User Confirmations",
                    "Updating Dashboards",
                    "Logging Audit Trails",
                    "Alerting Support Teams"
                ],
                patterns: [
                    { name: "Ack/Nack", desc: "Acknowledging receipt or signaling failure." },
                    { name: "Human-in-the-Loop", desc: "Escalating exceptions for manual review." },
                    { name: "Dead Letter Queue", desc: "Parking failed messages for later analysis." }
                ],
                azureTech: ["SendGrid", "Microsoft Teams Adapters", "Azure Monitor", "SignalR"]
            }
        };

        // --- Components ---

        const DigitalPulse = () => {
            return (
                <div className="w-full max-w-7xl mx-auto mt-5 mb-2 px-8 flex flex-col items-center">
                    <div className="w-full h-16 relative flex items-center">
                        <svg viewBox="0 0 1000 100" className="w-full h-full overflow-visible" preserveAspectRatio="none">
                            {/* Background Track (Faint) */}
                            <path 
                                d="M0 50 L 400 50 L 420 10 L 440 90 L 460 30 L 480 50 L 1000 50" 
                                fill="none" 
                                stroke="#e2e8f0" 
                                strokeWidth="4" 
                                strokeLinecap="round"
                                strokeLinejoin="round"
                            />
                            
                            {/* Moving Pulse (Bright Blue) */}
                            <path 
                                d="M0 50 L 400 50 L 420 10 L 440 90 L 460 30 L 480 50 L 1000 50" 
                                fill="none" 
                                stroke="#007cc0" 
                                strokeWidth="4" 
                                strokeLinecap="round"
                                strokeLinejoin="round"
                                className="ekg-path"
                            />
                        </svg>
                    </div>
                </div>
            );
        };

        const Sidebar = ({ activeSection, setActiveSection, mobileOpen, setMobileOpen }) => {
            const links = [
                { id: 'intro', label: 'Introduction' },
                { id: 'methodology', label: 'The Methodology' },
                { id: 'loop', label: 'Visualizing TITAN' },
                { id: 'inventory', label: 'Discovery Inventory' },
                { id: 'roi', label: 'ROI Calculator' },
            ];

            return (
                <aside className={`fixed inset-y-0 left-0 z-50 w-64 bg-white border-r border-gray-200 shadow-lg transform transition-transform duration-200 ease-in-out ${mobileOpen ? 'translate-x-0' : '-translate-x-full'} md:translate-x-0`}>
                    <div className="flex items-center justify-between h-20 px-6 bg-kenway-navy text-white">
                        <div className="flex flex-col">
                            <span className="text-2xl font-bold tracking-tight">TITAN</span>
                            <span className="text-xs text-kenway-blue font-medium tracking-wider">FRAMEWORK</span>
                        </div>
                        <div className="flex items-center gap-3">
                            <img src="./assets/Kenway IO Lab.jpg" alt="IO Lab" className="h-12 w-auto rounded bg-white/10" onError={(e) => {e.target.style.display='none'; e.target.nextSibling.style.display='flex'}} />
                            {/* Fallback if image fails to load in preview */}
                            <div className="hidden h-12 w-12 rounded bg-white/10 flex items-center justify-center border border-white/20">
                                <span className="text-[10px] font-bold text-center leading-none">IO<br/>LAB</span>
                            </div>
                            <button onClick={() => setMobileOpen(false)} className="md:hidden text-white opacity-80 hover:opacity-100">
                                <X size={24} />
                            </button>
                        </div>
                    </div>
                    <nav className="p-4 space-y-2 mt-4">
                        {links.map(link => (
                            <button
                                key={link.id}
                                onClick={() => {
                                    setActiveSection(link.id);
                                    setMobileOpen(false);
                                    document.getElementById(link.id).scrollIntoView({ behavior: 'smooth' });
                                }}
                                className={`flex items-center w-full px-4 py-3 text-sm font-semibold transition-all rounded-r-full sidebar-link ${activeSection === link.id ? 'active shadow-sm' : 'text-gray-600 hover:bg-gray-100 hover:text-kenway-navy'}`}
                            >
                                {link.label}
                            </button>
                        ))}
                    </nav>
                    <div className="absolute bottom-0 w-full p-6 border-t border-gray-100 bg-gray-50">
                        <p className="text-xs text-gray-500 font-medium">© 2024 Strategy & Architecture</p>
                        <p className="text-[10px] text-gray-400 mt-1 uppercase tracking-wider">Internal Confidential</p>
                    </div>
                </aside>
            );
        };

        const MethodologyModal = ({ data, onClose }) => {
            if (!data) return null;

            return (
                <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-kenway-navy/50 backdrop-blur-sm animate-in fade-in duration-200">
                    <div className="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto flex flex-col custom-scrollbar">
                        
                        {/* Header */}
                        <div className="p-8 border-b border-gray-100 flex justify-between items-start bg-gray-50 sticky top-0 z-10 rounded-t-2xl">
                            <div>
                                <div className="flex items-center gap-3 mb-2">
                                    <span className="bg-kenway-blue text-white px-2 py-1 rounded text-xs font-bold tracking-wider">METHODOLOGY DEEP DIVE</span>
                                    <h2 className="text-3xl font-bold text-kenway-navy m-0">{data.title}</h2>
                                </div>
                                <p className="text-xl text-kenway-blue font-medium m-0">{data.subtitle}</p>
                            </div>
                            <button onClick={onClose} className="p-2 hover:bg-gray-200 rounded-full transition-colors">
                                <X size={24} className="text-gray-500" />
                            </button>
                        </div>

                        {/* Content */}
                        <div className="p-8 md:p-12 space-y-10">
                            <div>
                                <p className="text-lg text-gray-700 leading-relaxed">{data.description}</p>
                            </div>

                            <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                {/* Key Activities */}
                                <div className="bg-gray-50 p-6 rounded-xl border border-gray-200">
                                    <h4 className="flex items-center gap-2 font-bold text-kenway-navy mb-4 uppercase text-sm tracking-wider">
                                        <Activity size={18} /> Key Activities
                                    </h4>
                                    <ul className="space-y-3">
                                        {data.keyActivities.map((activity, i) => (
                                            <li key={i} className="flex items-start gap-3 text-gray-700">
                                                <div className="mt-1.5 w-1.5 h-1.5 rounded-full bg-kenway-blue shrink-0"></div>
                                                <span>{activity}</span>
                                            </li>
                                        ))}
                                    </ul>
                                </div>

                                {/* Patterns */}
                                <div className="bg-blue-50 p-6 rounded-xl border border-blue-100">
                                    <h4 className="flex items-center gap-2 font-bold text-kenway-navy mb-4 uppercase text-sm tracking-wider">
                                        <BookOpen size={18} /> Common Patterns
                                    </h4>
                                    <div className="space-y-4">
                                        {data.patterns.map((pattern, i) => (
                                            <div key={i}>
                                                <span className="block font-bold text-kenway-navy text-sm">{pattern.name}</span>
                                                <span className="block text-sm text-gray-600">{pattern.desc}</span>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>

                            {/* Tech Stack */}
                            <div>
                                <h4 className="flex items-center gap-2 font-bold text-kenway-navy mb-4 uppercase text-sm tracking-wider">
                                    <Layers size={18} /> Recommended Azure Technologies
                                </h4>
                                <div className="flex flex-wrap gap-3">
                                    {data.azureTech.map((tech, i) => (
                                        <span key={i} className="px-4 py-2 bg-white border border-gray-200 rounded-full text-sm font-medium text-kenway-navy shadow-sm">
                                            {tech}
                                        </span>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const ArchitectureModal = ({ flowData, onClose }) => {
            if (!flowData) return null;
            const data = flowData;

            return (
                <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-kenway-navy/50 backdrop-blur-sm animate-in fade-in duration-200">
                    <div className="bg-white rounded-2xl shadow-2xl w-full max-w-5xl max-h-[90vh] overflow-y-auto flex flex-col custom-scrollbar">
                        
                        {/* Header */}
                        <div className="p-8 border-b border-gray-100 flex justify-between items-start bg-gray-50 sticky top-0 z-10 rounded-t-2xl">
                            <div>
                                <div className="flex items-center gap-3 mb-2">
                                    <span className="bg-kenway-blue text-white px-2 py-1 rounded text-xs font-bold tracking-wider">ARCHITECTURE VIEW</span>
                                    <h2 className="text-2xl font-bold text-kenway-navy m-0">{data.title}</h2>
                                </div>
                                <p className="text-gray-600 m-0">{data.description}</p>
                            </div>
                            <button onClick={onClose} className="p-2 hover:bg-gray-200 rounded-full transition-colors">
                                <X size={24} className="text-gray-500" />
                            </button>
                        </div>

                        {/* Content */}
                        <div className="p-8 md:p-12">
                            
                            {/* Flow Diagram */}
                            <div className="relative mb-16">
                                <h3 className="text-sm font-bold text-gray-400 uppercase tracking-widest mb-8">Data Flow Diagram</h3>
                                
                                {/* Desktop Flow */}
                                <div className="hidden md:flex justify-between items-center relative">
                                    {/* Connecting Line */}
                                    <div className="absolute top-1/2 left-0 w-full h-1 bg-gray-200 -z-0 rounded"></div>
                                    
                                    {data.steps.map((step, idx) => {
                                        const StepIcon = IconMap[step.icon] || Zap; // Fallback to Zap
                                        return (
                                            <div key={idx} className="relative z-10 flex flex-col items-center group cursor-default">
                                                <div className={`w-16 h-16 rounded-2xl flex items-center justify-center shadow-lg text-white mb-4 flow-node ${step.color} ${step.highlight ? 'ring-4 ring-purple-100 ring-offset-2' : ''}`}>
                                                    <StepIcon size={28} />
                                                </div>
                                                <div className="text-center bg-white p-2 rounded-lg border border-gray-100 shadow-sm w-32">
                                                    <div className={`text-[10px] font-bold mb-1 ${step.color.replace('bg-', 'text-')}`}>{step.stage}</div>
                                                    <div className="font-bold text-sm text-kenway-navy leading-tight">{step.label}</div>
                                                    <div className="text-[10px] text-gray-500 mt-1 truncate">{step.system}</div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>

                                {/* Mobile Flow */}
                                <div className="md:hidden flex flex-col gap-8 relative">
                                    <div className="absolute left-8 top-0 h-full w-1 bg-gray-200 -z-0"></div>
                                    {data.steps.map((step, idx) => {
                                        const StepIcon = IconMap[step.icon] || Zap;
                                        return (
                                            <div key={idx} className="relative z-10 flex items-center gap-4">
                                                <div className={`w-16 h-16 shrink-0 rounded-2xl flex items-center justify-center shadow-lg text-white ${step.color}`}>
                                                    <StepIcon size={28} />
                                                </div>
                                                <div className="bg-white p-3 rounded-lg border border-gray-100 shadow-sm flex-grow">
                                                    <div className={`text-[10px] font-bold mb-1 ${step.color.replace('bg-', 'text-')}`}>{step.stage}</div>
                                                    <div className="font-bold text-sm text-kenway-navy">{step.label}</div>
                                                    <div className="text-xs text-gray-500">{step.system}</div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>

                            {/* Tech Stack & Details */}
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div className="bg-gray-50 p-6 rounded-xl border border-gray-200">
                                    <h4 className="flex items-center gap-2 font-bold text-kenway-navy mb-4">
                                        <Server size={20} /> Recommended Tech Stack
                                    </h4>
                                    <ul className="space-y-2">
                                        {data.techStack.map((tech, i) => (
                                            <li key={i} className="flex items-center gap-2 text-sm text-gray-700">
                                                <CheckCircle size={16} className="text-green-500" /> {tech}
                                            </li>
                                        ))}
                                    </ul>
                                </div>
                                <div className="bg-blue-50 p-6 rounded-xl border border-blue-100">
                                    <h4 className="flex items-center gap-2 font-bold text-kenway-navy mb-4">
                                        <Activity size={20} /> Success Criteria
                                    </h4>
                                    <p className="text-sm text-gray-700">
                                        {data.successCriteria}
                                    </p>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            );
        };

        const TitanCard = ({ letter, title, icon: Icon, desc, color, onClick }) => (
            <div 
                onClick={onClick}
                className="card-hover relative p-8 bg-white border border-gray-100 rounded-xl shadow-sm transition-all duration-300 h-full flex flex-col cursor-pointer group hover:border-kenway-blue/30"
            >
                <div className={`absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity ${color}`}>
                    <Icon size={80} />
                </div>
                <div className="flex items-center gap-4 mb-6">
                    <span className={`flex shrink-0 items-center justify-center w-14 h-14 text-2xl font-bold text-white rounded-lg shadow-md transition-transform group-hover:scale-110 ${color.replace('text-', 'bg-')}`}>
                        {letter}
                    </span>
                    <h3 className="text-2xl font-bold text-kenway-navy m-0 tracking-tight group-hover:text-kenway-blue transition-colors">{title}</h3>
                </div>
                <div className="text-sm text-kenway-blue leading-relaxed font-medium flex-1 flex flex-col">
                    {desc}
                </div>
                <div className="mt-4 text-xs text-center text-gray-400 font-bold uppercase tracking-wider opacity-0 group-hover:opacity-100 transition-opacity">
                    Click to Deep Dive
                </div>
            </div>
        );

        const TitanLoopVisual = () => {
            const [isActive, setIsActive] = useState(false);

            return (
                // Increased mt-48 to mt-72 to prevent overlap with the paragraph above
                <div className="relative w-full max-w-7xl mx-auto mt-72 mb-48 flex items-center justify-center px-4">
                    
                    {/* TRIGGER INPUTS (Top) */}
                    <div 
                        className="absolute -top-48 left-1/2 -translate-x-1/2 z-10 flex flex-col items-center group cursor-default"
                        onMouseEnter={() => setIsActive(true)}
                        onMouseLeave={() => setIsActive(false)}
                    >
                        {/* Changed from grid to flex for a straight line */}
                        <div className="flex gap-4 mb-4">
                             <div className="flex items-center gap-3 bg-white p-3 rounded-xl shadow-md border border-gray-200 text-sm font-bold text-gray-600 transition-all group-hover:border-kenway-navy group-hover:text-kenway-navy group-hover:translate-y-1 group/item">
                                <Mail size={20} className="group-hover/item:scale-110 transition-transform"/> Email
                            </div>
                            <div className="flex items-center gap-3 bg-white p-3 rounded-xl shadow-md border border-gray-200 text-sm font-bold text-gray-600 transition-all group-hover:border-kenway-navy group-hover:text-kenway-navy group-hover:translate-y-1 group/item">
                                <MessageSquare size={20} className="group-hover/item:scale-110 transition-transform"/> Message
                            </div>
                            <div className="flex items-center gap-3 bg-white p-3 rounded-xl shadow-md border border-gray-200 text-sm font-bold text-gray-600 transition-all group-hover:border-kenway-navy group-hover:text-kenway-navy group-hover:translate-y-1 group/item">
                                <Clock size={20} className="group-hover/item:scale-110 transition-transform"/> Schedule
                            </div>
                            <div className="flex items-center gap-3 bg-white p-3 rounded-xl shadow-md border border-gray-200 text-sm font-bold text-gray-600 transition-all group-hover:border-kenway-navy group-hover:text-kenway-navy group-hover:translate-y-1 group/item">
                                <Wifi size={20} className="group-hover/item:scale-110 transition-transform"/> Sensor
                            </div>
                        </div>
                        
                        {/* Arrow Pointing Down into Trigger */}
                        <div className="flex flex-col items-center">
                            {/* Wire */}
                            <div className="w-3 h-20 bg-gray-200 relative overflow-hidden rounded-t-full -mb-1">
                                <div className="absolute top-0 inset-x-0 bg-kenway-navy h-0 group-hover:h-full transition-all duration-700 ease-out"></div>
                            </div>
                            {/* Head */}
                            <div className="w-0 h-0 border-l-[12px] border-l-transparent border-r-[12px] border-r-transparent border-t-[24px] border-t-gray-200 group-hover:border-t-kenway-navy transition-colors duration-700"></div>
                        </div>
                    </div>

                    {/* NOTIFY OUTPUTS (Left) */}
                    <div 
                        className="hidden xl:flex flex-col items-end absolute -left-24 top-1/2 -translate-y-1/2 z-10 group cursor-default"
                        onMouseEnter={() => setIsActive(true)}
                        onMouseLeave={() => setIsActive(false)}
                    >
                        <div className="flex items-center">
                            <div className="grid grid-cols-1 gap-4 mr-4 w-48">
                                <div className="flex items-center gap-3 bg-white p-3 rounded-xl shadow-md border border-gray-200 text-sm font-bold text-gray-600 transition-all group-hover:border-green-600 group-hover:text-green-600 group-hover:-translate-x-1 group/item">
                                    <Mail size={20} className="group-hover/item:scale-110 transition-transform"/> Email
                                </div>
                                <div className="flex items-center gap-3 bg-white p-3 rounded-xl shadow-md border border-gray-200 text-sm font-bold text-gray-600 transition-all group-hover:border-green-600 group-hover:text-green-600 group-hover:-translate-x-1 group/item">
                                    <MessageSquare size={20} className="group-hover/item:scale-110 transition-transform"/> Message
                                </div>
                                <div className="flex items-center gap-3 bg-white p-3 rounded-xl shadow-md border border-gray-200 text-sm font-bold text-gray-600 transition-all group-hover:border-green-600 group-hover:text-green-600 group-hover:-translate-x-1 group/item">
                                    <AlertTriangle size={20} className="group-hover/item:scale-110 transition-transform"/> Error
                                </div>
                                <div className="flex items-center gap-3 bg-white p-3 rounded-xl shadow-md border border-gray-200 text-sm font-bold text-gray-600 transition-all group-hover:border-green-600 group-hover:text-green-600 group-hover:-translate-x-1 group/item">
                                    <Zap size={20} className="group-hover/item:scale-110 transition-transform"/> Next Loop
                                </div>
                            </div>

                            {/* Arrow Pointing Left (Out of Notify) */}
                            <div className="flex items-center ml-2">
                                {/* Head - Changed to green-600 */}
                                <div className="w-0 h-0 border-t-[12px] border-t-transparent border-r-[24px] border-r-gray-200 border-b-[12px] border-b-transparent -mr-2 z-10 group-hover:border-r-green-600 transition-colors duration-700"></div>
                                {/* Wire - Changed to green-600 */}
                                <div className="h-3 w-28 bg-gray-200 relative -ml-1 overflow-hidden rounded-r-full">
                                    <div className="absolute right-0 inset-y-0 bg-green-600 w-0 group-hover:w-full transition-all duration-700 ease-out"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* ACT OUTPUTS (Bottom) */}
                    <div 
                        className="absolute -bottom-52 left-1/2 -translate-x-1/2 z-10 flex flex-col items-center group cursor-default"
                        onMouseEnter={() => setIsActive(true)}
                        onMouseLeave={() => setIsActive(false)}
                    >
                        {/* Arrow Pointing Down (Out of Act) */}
                        <div className="flex flex-col items-center mb-4">
                            {/* Wire */}
                            <div className="w-3 h-20 bg-gray-200 relative overflow-hidden rounded-t-full -mb-1">
                                <div className="absolute top-0 inset-x-0 bg-orange-500 h-0 group-hover:h-full transition-all duration-700 ease-out"></div>
                            </div>
                            {/* Head */}
                            <div className="w-0 h-0 border-l-[12px] border-l-transparent border-r-[12px] border-r-transparent border-t-[24px] border-t-gray-200 group-hover:border-t-orange-500 transition-colors duration-700"></div>
                        </div>

                        <div className="grid grid-cols-3 gap-4 w-[28rem]">
                            <div className="flex items-center gap-3 bg-white p-3 rounded-xl shadow-md border border-gray-200 text-sm font-bold text-gray-600 transition-all group-hover:border-orange-500 group-hover:text-orange-500 group-hover:translate-y-1 group/item">
                                <User size={20} className="group-hover/item:scale-110 transition-transform"/> Manual
                            </div>
                            <div className="flex items-center gap-3 bg-white p-3 rounded-xl shadow-md border border-gray-200 text-sm font-bold text-gray-600 transition-all group-hover:border-orange-500 group-hover:text-orange-500 group-hover:translate-y-1 group/item">
                                <AppWindow size={20} className="group-hover/item:scale-110 transition-transform"/> Application
                            </div>
                            <div className="flex items-center gap-3 bg-white p-3 rounded-xl shadow-md border border-gray-200 text-sm font-bold text-gray-600 transition-all group-hover:border-orange-500 group-hover:text-orange-500 group-hover:translate-y-1 group/item">
                                <LayoutTemplate size={20} className="group-hover/item:scale-110 transition-transform"/> Dashboards
                            </div>
                        </div>
                    </div>

                    {/* Main Loop Circle */}
                    <div className="relative w-96 h-96 bg-white rounded-full shadow-2xl flex items-center justify-center p-12 z-10 border border-gray-100">
                        {/* Central Brain */}
                        <div className="absolute z-20 flex flex-col items-center justify-center w-36 h-36 bg-kenway-navy text-white rounded-full shadow-2xl border-4 border-kenway-blue">
                            <BrainCircuit size={48} strokeWidth={1.5} className="text-white mb-2 opacity-90" />
                            <span className="text-sm font-bold tracking-widest">THINK</span>
                            <span className="text-[10px] text-gray-300 text-center px-2 mt-1 font-medium">Intelligence Layer</span>
                        </div>

                        {/* Orbit Ring - Color change ONLY, NO acceleration */}
                        <div className={`absolute w-3/4 h-3/4 border-2 border-dashed border-gray-300 rounded-full animate-spin-slow transition-all duration-700 ${isActive ? 'border-kenway-blue opacity-100' : 'opacity-40'}`}></div>

                        {/* Nodes */}
                        <div className="absolute top-0 left-1/2 -translate-x-1/2 translate-y-4 flex flex-col items-center">
                            <div className="w-14 h-14 bg-white border-2 border-kenway-navy rounded-full flex items-center justify-center shadow-lg text-kenway-navy mb-2 z-10">
                                <Zap size={24} />
                            </div>
                            <span className="font-bold text-kenway-navy text-xs tracking-wider bg-white px-2 py-0.5 rounded shadow-sm">TRIGGER</span>
                        </div>

                        <div className="absolute top-1/2 right-0 -translate-x-4 -translate-y-1/2 flex flex-col items-center">
                            <div className="w-14 h-14 bg-white border-2 border-kenway-blue rounded-full flex items-center justify-center shadow-lg text-kenway-blue mb-2 z-10">
                                <Database size={24} />
                            </div>
                            <span className="font-bold text-kenway-navy text-xs tracking-wider bg-white px-2 py-0.5 rounded shadow-sm">INGEST</span>
                        </div>

                        <div className="absolute bottom-0 left-1/2 -translate-x-1/2 -translate-y-4 flex flex-col items-center">
                            <div className="w-14 h-14 bg-white border-2 border-orange-500 rounded-full flex items-center justify-center shadow-lg text-orange-500 mt-2 order-2 z-10">
                                <Activity size={24} />
                            </div>
                            <span className="font-bold text-kenway-navy text-xs tracking-wider bg-white px-2 py-0.5 rounded shadow-sm order-1">ACT</span>
                        </div>

                        <div className="absolute top-1/2 left-0 translate-x-4 -translate-y-1/2 flex flex-col items-center">
                            <div className="w-14 h-14 bg-white border-2 border-green-600 rounded-full flex items-center justify-center shadow-lg text-green-600 mb-2 z-10">
                                <CheckCircle size={24} />
                            </div>
                            <span className="font-bold text-kenway-navy text-xs tracking-wider bg-white px-2 py-0.5 rounded shadow-sm">NOTIFY</span>
                        </div>
                    </div>

                    {/* Right Connection (External Data) - Hidden on smaller screens */}
                    {/* Flow: Data -> Ingest (Arrow points Left) */}
                    <div 
                        className="hidden xl:flex flex-col items-center absolute -right-14 top-1/2 -translate-y-1/2 z-0 group cursor-default"
                        onMouseEnter={() => setIsActive(true)}
                        onMouseLeave={() => setIsActive(false)}
                    >
                        <div className="flex items-center">
                            {/* Connecting Wire with Gap */}
                            <div className="flex items-center ml-8">
                                <div className="w-0 h-0 border-t-[12px] border-t-transparent border-r-[24px] border-r-gray-200 border-b-[12px] border-b-transparent -mr-2 z-10 group-hover:border-r-kenway-blue transition-colors duration-700"></div>
                                <div className="h-3 w-32 bg-gray-200 relative -ml-1 overflow-hidden rounded-r-full">
                                    <div className="absolute right-0 inset-y-0 bg-kenway-blue w-0 group-hover:w-full transition-all duration-700 ease-out"></div>
                                </div>
                            </div>
                            
                            <div className="flex flex-col gap-4 relative z-10 ml-6">
                                <div className="flex items-center gap-4 text-sm font-bold text-gray-600 bg-white px-6 py-4 rounded-xl border-2 border-gray-100 shadow-lg hover:shadow-xl transition-all group-hover:translate-x-1 group-hover:border-blue-100">
                                    <Cloud size={24} strokeWidth={1.5} className="text-kenway-blue opacity-70" /> Data Lake
                                </div>
                                <div className="flex items-center gap-4 text-sm font-bold text-gray-600 bg-white px-6 py-4 rounded-xl border-2 border-gray-100 shadow-lg hover:shadow-xl transition-all group-hover:translate-x-1 group-hover:border-blue-100 delay-75">
                                    <Server size={24} strokeWidth={1.5} className="text-kenway-blue opacity-70" /> ERP Core
                                </div>
                                <div className="flex items-center gap-4 text-sm font-bold text-gray-600 bg-white px-6 py-4 rounded-xl border-2 border-gray-100 shadow-lg hover:shadow-xl transition-all group-hover:translate-x-1 group-hover:border-blue-100 delay-150">
                                    <FileText size={24} strokeWidth={1.5} className="text-kenway-blue opacity-70" /> Documents
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            );
        };

        const InventoryTable = ({ data, onSelectFlow }) => {
            const [sortConfig, setSortConfig] = useState({ key: null, direction: 'ascending' });
            const [filterSystem, setFilterSystem] = useState('All');

            const parseImpact = (str) => {
                if (str === 'High Risk') return 999999999;
                const multiplier = str.includes('M') ? 1000000 : str.includes('k') ? 1000 : 1;
                return parseFloat(str.replace(/[^0-9.]/g, '')) * multiplier;
            };

            // Derive unique systems for the filter dropdown
            const systems = React.useMemo(() => {
                if (!data) return ['All'];
                const uniqueSystems = new Set(Object.values(data).map(flow => flow.steps[0].system));
                return ['All', ...Array.from(uniqueSystems).sort()];
            }, [data]);

            const sortedRows = React.useMemo(() => {
                if (!data) return [];
                let rows = Object.entries(data).map(([id, flow]) => ({
                    id,
                    name: flow.title,
                    impact: flow.impact,
                    system: flow.steps[0].system,
                    trigger: flow.steps[0].label,
                    ingest: flow.steps[1].label,
                    think: flow.steps[2].label,
                    act: flow.steps[3].label,
                    notify: flow.steps[4].label
                }));

                // Apply Filter
                if (filterSystem !== 'All') {
                    rows = rows.filter(row => row.system === filterSystem);
                }

                // Apply Sort
                if (sortConfig.key) {
                    rows.sort((a, b) => {
                        let aVal = a[sortConfig.key];
                        let bVal = b[sortConfig.key];

                        if (sortConfig.key === 'impact') {
                            aVal = parseImpact(aVal);
                            bVal = parseImpact(bVal);
                        }

                        if (aVal < bVal) return sortConfig.direction === 'ascending' ? -1 : 1;
                        if (aVal > bVal) return sortConfig.direction === 'ascending' ? 1 : -1;
                        return 0;
                    });
                }
                return rows;
            }, [sortConfig, filterSystem, data]);

            const handleSort = (key) => {
                setSortConfig(current => ({
                    key,
                    direction: current.key === key && current.direction === 'ascending' ? 'descending' : 'ascending'
                }));
            };

            const SortIcon = ({ column }) => {
                if (sortConfig.key !== column) return <span className="w-4 h-4 ml-1 inline-block opacity-0 group-hover:opacity-30"><ChevronDown size={14}/></span>;
                return sortConfig.direction === 'ascending' 
                    ? <span className="w-4 h-4 ml-1 inline-block text-kenway-blue"><ChevronUp size={14}/></span>
                    : <span className="w-4 h-4 ml-1 inline-block text-kenway-blue"><ChevronDown size={14}/></span>;
            };

            if (!data) return <div className="p-8 text-center text-gray-500">Loading inventory data...</div>;

            return (
                <div className="flex flex-col gap-4">
                    {/* Filter Bar */}
                    <div className="flex justify-end">
                        <div className="relative inline-block w-64">
                            <select 
                                value={filterSystem}
                                onChange={(e) => setFilterSystem(e.target.value)}
                                className="block appearance-none w-full bg-white border border-gray-300 hover:border-gray-400 px-4 py-2 pr-8 rounded shadow leading-tight focus:outline-none focus:ring-1 focus:ring-kenway-blue focus:border-kenway-blue text-sm font-medium text-gray-700 cursor-pointer"
                            >
                                {systems.map(sys => (
                                    <option key={sys} value={sys}>{sys === 'All' ? 'Filter by System: All' : sys}</option>
                                ))}
                            </select>
                            <div className="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                                <ChevronDown size={14} />
                            </div>
                        </div>
                    </div>

                    <div className="overflow-x-auto bg-white border border-gray-200 rounded-xl shadow-lg">
                        <table className="min-w-full divide-y divide-gray-200 text-sm">
                            <thead className="bg-kenway-navy text-white">
                                <tr>
                                    <th className="px-6 py-4 text-left font-semibold tracking-wide">Opportunity</th>
                                    <th 
                                        className="px-6 py-4 text-left font-semibold tracking-wide cursor-pointer group select-none hover:bg-white/10 transition-colors"
                                        onClick={() => handleSort('system')}
                                    >
                                        <div className="flex items-center">
                                            Source System <SortIcon column="system" />
                                        </div>
                                    </th>
                                    <th 
                                        className="px-6 py-4 text-left font-semibold tracking-wide cursor-pointer group select-none hover:bg-white/10 transition-colors"
                                        onClick={() => handleSort('impact')}
                                    >
                                        <div className="flex items-center">
                                            Impact <SortIcon column="impact" />
                                        </div>
                                    </th>
                                    <th className="px-6 py-4 text-left font-semibold tracking-wide text-kenway-blue">T - Trigger</th>
                                    <th className="px-6 py-4 text-left font-semibold tracking-wide text-cyan-400">I - Ingest</th>
                                    <th className="px-6 py-4 text-left font-semibold tracking-wide text-purple-300">T - Think</th>
                                    <th className="px-6 py-4 text-left font-semibold tracking-wide text-orange-300">A - Act</th>
                                    <th className="px-6 py-4 text-left font-semibold tracking-wide text-green-300">N - Notify</th>
                                    <th className="px-6 py-4"></th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-gray-100">
                                {sortedRows.map((row, idx) => (
                                    <tr key={idx} className="hover:bg-blue-50 transition-colors group">
                                        <td className="px-6 py-4 font-bold text-kenway-navy">{row.name}</td>
                                        <td className="px-6 py-4 text-gray-600 font-medium text-xs">{row.system}</td>
                                        <td className="px-6 py-4 text-gray-600 font-medium">{row.impact}</td>
                                        <td className="px-6 py-4 text-gray-500">{row.trigger}</td>
                                        <td className="px-6 py-4 text-gray-500">{row.ingest}</td>
                                        <td className="px-6 py-4">
                                            <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800 border border-purple-200">
                                                {row.think}
                                            </span>
                                        </td>
                                        <td className="px-6 py-4 text-gray-500">{row.act}</td>
                                        <td className="px-6 py-4 text-gray-500">{row.notify}</td>
                                        <td className="px-6 py-4 text-right">
                                            <button 
                                                onClick={() => onSelectFlow(row.id)}
                                                className="opacity-0 group-hover:opacity-100 transition-opacity bg-kenway-blue text-white px-3 py-1.5 rounded text-xs font-semibold flex items-center gap-1 hover:bg-kenway-navy"
                                            >
                                                View <ArrowRight size={12}/>
                                            </button>
                                        </td>
                                    </tr>
                                ))}
                                {sortedRows.length === 0 && (
                                    <tr>
                                        <td colSpan="9" className="px-6 py-8 text-center text-gray-500">
                                            No opportunities found for the selected system.
                                        </td>
                                    </tr>
                                )}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        };

        const ROICalc = () => {
            const [volume, setVolume] = useState(500);
            const [minutes, setMinutes] = useState(15);
            const [rate, setRate] = useState(50);
            const [cost, setCost] = useState(25000);

            const annualSavings = (volume * (minutes / 60) * rate) * 12;
            const roiMonths = cost / (annualSavings / 12);

            return (
                <div className="bg-white border border-gray-200 p-8 rounded-xl shadow-lg">
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-10">
                        <div className="space-y-6">
                            <h4 className="font-bold text-kenway-navy flex items-center gap-2 text-lg border-b border-gray-100 pb-2">
                                <Calculator size={20} className="text-kenway-blue" /> Opportunity Inputs
                            </h4>
                            <div className="grid grid-cols-1 gap-4">
                                <div>
                                    <label className="block text-xs font-bold text-gray-500 uppercase tracking-wide mb-1">Monthly Volume</label>
                                    <input type="number" value={volume} onChange={e => setVolume(e.target.value)} className="block w-full rounded-lg border-gray-300 shadow-sm focus:border-kenway-blue focus:ring-kenway-blue sm:text-sm p-3 border bg-gray-50" />
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-gray-500 uppercase tracking-wide mb-1">Manual Time (Mins/Unit)</label>
                                    <input type="number" value={minutes} onChange={e => setMinutes(e.target.value)} className="block w-full rounded-lg border-gray-300 shadow-sm focus:border-kenway-blue focus:ring-kenway-blue sm:text-sm p-3 border bg-gray-50" />
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-gray-500 uppercase tracking-wide mb-1">Hourly Labor Rate ($)</label>
                                    <input type="number" value={rate} onChange={e => setRate(e.target.value)} className="block w-full rounded-lg border-gray-300 shadow-sm focus:border-kenway-blue focus:ring-kenway-blue sm:text-sm p-3 border bg-gray-50" />
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-gray-500 uppercase tracking-wide mb-1">Est. Implementation Cost ($)</label>
                                    <input type="number" value={cost} onChange={e => setCost(e.target.value)} className="block w-full rounded-lg border-gray-300 shadow-sm focus:border-kenway-blue focus:ring-kenway-blue sm:text-sm p-3 border bg-gray-50" />
                                </div>
                            </div>
                        </div>
                        <div className="bg-kenway-navy text-white p-8 rounded-xl shadow-inner flex flex-col justify-center space-y-8 relative overflow-hidden">
                            <div className="absolute top-0 right-0 p-8 opacity-5">
                                <Activity size={120} />
                            </div>
                            <div className="relative z-10">
                                <span className="block text-sm text-blue-200 font-medium uppercase tracking-wider mb-1">Projected Annual Savings</span>
                                <span className="text-4xl font-bold text-white">${annualSavings.toLocaleString()}</span>
                            </div>
                            <div className="relative z-10">
                                <span className="block text-sm text-blue-200 font-medium uppercase tracking-wider mb-1">ROI Break-even</span>
                                <span className="text-4xl font-bold text-kenway-blue">{roiMonths.toFixed(1)} Months</span>
                            </div>
                            <div className="text-xs text-gray-400 mt-4 pt-4 border-t border-blue-900">
                                *Estimates based on provided labor inputs. Actual results may vary based on complexity.
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        const App = () => {
            const [mobileOpen, setMobileOpen] = useState(false);
            const [activeSection, setActiveSection] = useState('intro');
            const [selectedFlowId, setSelectedFlowId] = useState(null);
            const [inventoryData, setInventoryData] = useState(null);
            const [loading, setLoading] = useState(true);
            const [selectedMethodology, setSelectedMethodology] = useState(null);
            const [methodologyData, setMethodologyData] = useState(null);

            // Fetch Inventory Data
            useEffect(() => {
                fetch('./assets/inventory.json')
                    .then(res => {
                        if (!res.ok) throw new Error("Failed to fetch inventory");
                        return res.json();
                    })
                    .then(data => {
                        setInventoryData(data);
                        setLoading(false);
                    })
                    .catch(err => {
                        console.warn("Assets not found, falling back to mock inventory data:", err);
                        setInventoryData(MOCK_INVENTORY);
                        setLoading(false);
                    });
            }, []);

            // Fetch Methodology Data
            useEffect(() => {
                fetch('./assets/methodology.json')
                    .then(res => {
                        if (!res.ok) throw new Error("Failed to fetch methodology");
                        return res.json();
                    })
                    .then(data => {
                        setMethodologyData(data);
                    })
                    .catch(err => {
                        console.warn("Assets not found, falling back to mock methodology data:", err);
                        setMethodologyData(MOCK_METHODOLOGY_DETAILS);
                    });
            }, []);

            // Handle URL params for deep linking
            useEffect(() => {
                if (loading || !inventoryData) return;
                
                const params = new URLSearchParams(window.location.search);
                const flowId = params.get('flow');
                if (flowId && inventoryData[flowId]) {
                    setSelectedFlowId(flowId);
                }
            }, [loading, inventoryData]);

            const handleFlowSelect = (id) => {
                setSelectedFlowId(id);
                // Update URL without refresh
                const url = new URL(window.location);
                url.searchParams.set('flow', id);
                window.history.pushState({}, '', url);
            };

            const handleCloseModal = () => {
                setSelectedFlowId(null);
                const url = new URL(window.location);
                url.searchParams.delete('flow');
                window.history.pushState({}, '', url);
            };

            const handleMethodologyClick = (key) => {
                if (methodologyData && methodologyData[key]) {
                    setSelectedMethodology(methodologyData[key]);
                }
            };

            // Scroll Spy Effect for Sidebar Highlighting
            useEffect(() => {
                const observerOptions = {
                    root: null,
                    // These margins define the "active area" of the screen.
                    // -20% from top: Keeps the header area clear
                    // -50% from bottom: Triggers when the section crosses the middle of the screen
                    rootMargin: '-20% 0px -50% 0px', 
                    threshold: 0.1
                };

                const observerCallback = (entries) => {
                    entries.forEach((entry) => {
                        if (entry.isIntersecting) {
                            setActiveSection(entry.target.id);
                        }
                    });
                };

                const observer = new IntersectionObserver(observerCallback, observerOptions);
                const sections = ['intro', 'methodology', 'loop', 'inventory', 'roi'];
                
                sections.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) observer.observe(element);
                });

                return () => observer.disconnect();
            }, []); // Empty dependency array ensures this runs once on mount

            return (
                <div className="min-h-screen bg-gray-50">
                    <Sidebar 
                        activeSection={activeSection} 
                        setActiveSection={setActiveSection} 
                        mobileOpen={mobileOpen} 
                        setMobileOpen={setMobileOpen} 
                    />

                    {/* Mobile Header */}
                    <div className="md:hidden flex items-center justify-between p-4 bg-kenway-navy text-white fixed top-0 w-full z-40 shadow-md">
                        <span className="text-lg font-bold">TITAN Framework</span>
                        <button onClick={() => setMobileOpen(true)}>
                            <Menu size={24} />
                        </button>
                    </div>

                    {/* Architecture Modal */}
                    {selectedFlowId && inventoryData && (
                        <ArchitectureModal 
                            flowData={inventoryData[selectedFlowId]} 
                            onClose={handleCloseModal} 
                        />
                    )}

                    {/* Methodology Modal (TITAN Deep Dive) */}
                    {selectedMethodology && (
                        <MethodologyModal 
                            data={selectedMethodology} 
                            onClose={() => setSelectedMethodology(null)} 
                        />
                    )}

                    {/* Main Content */}
                    <main className="md:ml-64 pt-20 md:pt-0">
                        {/* Changed max-w-5xl to max-w-7xl for wider layout */}
                        <div className="max-w-7xl mx-auto px-8 py-16 prose prose-slate max-w-none">
             
                            {/* Hero Section */}
                            <section id="intro" className="mb-6 max-w-5xl mx-auto">
                                <div className="bg-kenway-navy text-white p-12 rounded-2xl mb-10 shadow-xl relative overflow-hidden flex items-center min-h-[320px]">
                                    
                                    {/* Text Content */}
                                    <div className="relative z-20 max-w-xl">
                                        <h1 className="text-4xl md:text-6xl font-bold mb-6 tracking-tight !text-white !mt-0 text-gradient-red font-classic">TITAN Framework</h1>
                                        <p className="!text-cyan-200 text-xl leading-relaxed !mb-0 font-medium">
                                            The enterprise standard for building <strong>Cognitive Integration Loops</strong>. 
                                            Move beyond "dumb pipes" to autonomous systems that think and act.
                                        </p>
                                    </div>

                                    {/* Image Container (Replaces BrainCircuit) */}
                                    <div className="absolute top-0 right-0 w-2/3 h-full z-10">
                                        <img 
                                            src="./assets/TitanImage.jpg" 
                                            alt="Hero Background" 
                                            className="w-full h-full object-contain object-right opacity-90"
                                            onError={(e) => e.target.style.opacity = 0} 
                                        />
                                        {/* Blue Overlay */}
                                        <div className="absolute inset-0 bg-kenway-blue/40 mix-blend-overlay"></div>
                                        {/* Gradient fade to blend with navy background on the left */}
                                        <div className="absolute inset-0 bg-gradient-to-r from-kenway-navy via-kenway-navy/60 to-transparent"></div>
                                    </div>
                                </div>
                                
                                <div className="bg-white border-l-4 border-kenway-blue p-6 rounded-r-lg shadow-sm">
                                    <h4 className="text-kenway-navy font-bold m-0 flex items-center gap-3 text-lg">
                                        <LayoutTemplate size={20} className="text-kenway-blue"/> Enterprise Architecture Standard
                                    </h4>
                                    <p className="m-0 text-gray-600 mt-2">
                                        Designed specifically for the modern enterprise stack: <strong>Dynamics 365 F&SCM</strong>, <strong>Business Central</strong>, <strong>Salesforce</strong>, and <strong>SAP</strong>. TITAN replaces fragile point-to-point integrations with a robust, event-driven architecture pattern standardizing communication across Azure, AWS, and SAP BTP.
                                    </p>
                                </div>

                                <p className="text-lg mt-8 leading-relaxed max-w-5xl mx-auto">
                                    Modern enterprises cannot survive on "Data Movement" alone. They require "Decision Velocity." 
                                    The TITAN framework provides a rigorous taxonomy for identifying, building, and measuring 
                                    automation loops that drive business value.
                                </p>

                                {/* Digital Pulse Transition */}
                                <DigitalPulse />
                            </section>

                            {/* Methodology Section */}
                            <section id="methodology" className="mb-24 pt-10">
                                <div className="max-w-5xl mx-auto">
                                    <h2>The Methodology</h2>
                                    <p className="text-lg">
                                        Every robust automation consists of five distinct stages. Failing to account for any single stage results in fragile, unscalable integrations.
                                    </p>
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-5 gap-6 mt-10 not-prose">
                                    <TitanCard 
                                        letter="T" title="Trigger" color="text-kenway-navy" icon={Zap}
                                        onClick={() => handleMethodologyClick('T')}
                                        desc={
                                            <>
                                                <div>
                                                    <strong className="block mb-2 text-kenway-navy text-base">The Pulse</strong>
                                                    What initiates the loop?
                                                    <ul className="list-disc pl-4 mt-2 space-y-1 opacity-80">
                                                        <li>Business Event</li>
                                                        <li>Temporal Event</li>
                                                        <li>Sensor Signal</li>
                                                    </ul>
                                                </div>
                                                <div className="mt-auto pt-6 border-t border-blue-100/50 text-kenway-navy italic opacity-90">
                                                    "Don't just wait. React."
                                                </div>
                                            </>
                                        } 
                                    />
                                    <TitanCard 
                                        letter="I" title="Ingest" color="text-kenway-blue" icon={Database}
                                        onClick={() => handleMethodologyClick('I')}
                                        desc={
                                            <>
                                                <div>
                                                    <strong className="block mb-2 text-kenway-navy text-base">The Context</strong>
                                                    Raw triggers are rarely enough. We must 'hydrate' the event with:
                                                    <ul className="list-disc pl-4 mt-2 space-y-1 opacity-80">
                                                        <li>Historical Data</li>
                                                        <li>Master Data</li>
                                                        <li>Cross-Reference IDs</li>
                                                    </ul>
                                                </div>
                                                <div className="mt-auto pt-6 border-t border-blue-100/50 text-kenway-navy italic opacity-90">
                                                    "Data without context is noise."
                                                </div>
                                            </>
                                        } 
                                    />
                                    
                                    <TitanCard 
                                        letter="T" title="Think" color="text-purple-600" icon={BrainCircuit}
                                        onClick={() => handleMethodologyClick('T2')}
                                        desc={
                                            <>
                                                <div>
                                                    <strong className="block mb-2 text-kenway-navy text-base">The Intelligence</strong>
                                                    The key differentiator.
                                                    <ul className="list-disc pl-4 mt-2 space-y-1 opacity-80">
                                                        <li>Boolean Rules</li>
                                                        <li>Agentic AI</li>
                                                        <li>Sentiment Analysis</li>
                                                    </ul>
                                                </div>
                                                <div className="mt-auto pt-6 border-t border-blue-100/50 text-kenway-navy italic opacity-90">
                                                    "Move from automation to autonomy."
                                                </div>
                                            </>
                                        } 
                                    />
                                    
                                    <TitanCard 
                                        letter="A" title="Act" color="text-orange-500" icon={Activity}
                                        onClick={() => handleMethodologyClick('A')}
                                        desc={
                                            <>
                                                <div>
                                                    <strong className="block mb-2 text-kenway-navy text-base">The Muscle</strong>
                                                    The deterministic state change in the target system.
                                                    <div className="mt-2 opacity-80">
                                                        Must be idempotent and transactional.
                                                    </div>
                                                </div>
                                                <div className="mt-auto pt-6 border-t border-blue-100/50 text-kenway-navy italic opacity-90">
                                                    "Execute with precision."
                                                </div>
                                            </>
                                        } 
                                    />
                                    <TitanCard 
                                        letter="N" title="Notify" color="text-green-600" icon={CheckCircle}
                                        onClick={() => handleMethodologyClick('N')}
                                        desc={
                                            <>
                                                <div>
                                                    <strong className="block mb-2 text-kenway-navy text-base">The Resolution</strong>
                                                    Closing the loop.
                                                    <ul className="list-disc pl-4 mt-2 space-y-1 opacity-80">
                                                        <li>Proof of Success</li>
                                                        <li>Failure Alerts</li>
                                                        <li>Transaction Receipt</li>
                                                    </ul>
                                                </div>
                                                <div className="mt-auto pt-6 border-t border-blue-100/50 text-kenway-navy italic opacity-90">
                                                    "Every action needs a receipt."
                                                </div>
                                            </>
                                        } 
                                    />
                                </div>
                            </section>

                            {/* Visualizing Loop Section */}
                            <section id="loop" className="mb-24 pt-10 max-w-5xl mx-auto">
                                <h2>Visualizing the Loop</h2>
                                <p className="text-lg">
                                    Unlike linear ETL pipelines, a TITAN is a continuous loop. The "Notify" step of one process often becomes the "Trigger" for the next, creating a self-reinforcing system of intelligence.
                                </p>
                                <TitanLoopVisual />
                            </section>

                            {/* Inventory Section */}
                            <section id="inventory" className="mb-24 pt-10 max-w-7xl mx-auto">
                                <h2>Discovery Inventory</h2>
                                <p className="text-lg">
                                    Use the <strong>TITAN Controlled Vocabulary</strong> to build your backlog. Select a row to view the architecture deep-dive.
                                </p>
                                <div className="not-prose mt-10">
                                    <InventoryTable 
                                        data={inventoryData}
                                        onSelectFlow={handleFlowSelect} 
                                    />
                                </div>
                            </section>

                            {/* ROI Section */}
                            <section id="roi" className="mb-24 pt-10 max-w-5xl mx-auto">
                                <h2>ROI Estimation Engine</h2>
                                <p className="text-lg">
                                    Don't build just to build. Use the standard formula to justify the engineering effort for every TITAN loop.
                                </p>
                                <div className="not-prose mt-10">
                                    <ROICalc />
                                </div>
                            </section>

                        </div>
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>